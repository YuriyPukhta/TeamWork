{"ast":null,"code":"var _jsxFileName = \"D:\\\\project\\\\QQMerged\\\\ClientApp\\\\src\\\\components\\\\GeneralQueue.jsx\";\nimport React, { Component } from 'react';\nimport { Container, Row, Col } from 'reactstrap';\nimport Cookies from 'js-cookie';\nimport { Virtuoso } from 'react-virtuoso';\nimport CustomScrollbar from \"./CustomScroller\";\nimport \"overlayscrollbars/css/OverlayScrollbars.css\";\nimport './GeneralQueue.scss';\nimport { Redirect, withRouter } from \"react-router-dom\";\nimport { AppContext } from './AppContext.jsx';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport class GeneralQueue extends Component {\n  constructor(props) {\n    super(props);\n    this.intervalID = 0;\n    this.state = {\n      qname: \"\",\n      queue: [],\n      qonline: true,\n      loading: true,\n      id: this.props.match.params.id,\n      isOdmen: false,\n      redirect: false,\n      clicker: 0,\n      isInQueue: false,\n      placeInQueue: -1,\n      userId: sessionStorage.getItem('id')\n    };\n    this.handleNext = this.handleNext.bind(this);\n    this.click = this.click.bind(this);\n    this.handleFreeze = this.handleFreeze.bind(this);\n    this.handleJoin = this.handleJoin.bind(this);\n  }\n\n  componentDidMount() {\n    this.intervalID = setInterval(() => {\n      this.qupdate();\n    }, 3000);\n  }\n\n  componentWillUnmount() {\n    clearInterval(this.intervalID);\n  }\n\n  async handleNext() {\n    console.log(\"next\");\n\n    if (this.state.isOdmen) {\n      const token = \"Bearer \" + Cookies.get('JWT');\n      const requestOptions = {\n        method: 'PUT',\n        headers: {\n          'Authorization': token\n        }\n      };\n      const response = await fetch(`/queue/${this.state.id}/moder/next`, requestOptions);\n\n      if (response.ok) {\n        this.qupdate();\n      }\n    } else {\n      this.setState({\n        redirect: true\n      });\n    }\n  }\n\n  async handleFreeze() {\n    if (this.state.isOdmen) {\n      const token = \"Bearer \" + Cookies.get('JWT');\n      const requestOptions = {\n        method: 'PUT',\n        headers: {\n          'Authorization': token\n        }\n      };\n\n      if (this.state.qonline) {\n        const response = await fetch(`/queue/${this.state.id}/moder/close`, requestOptions);\n\n        if (response.ok) {\n          this.qupdate();\n        }\n      } else {\n        const response = await fetch(`/queue/${this.state.id}/moder/open`, requestOptions);\n\n        if (response.ok) {\n          this.qupdate();\n        }\n      }\n    } else {\n      this.setState({\n        redirect: true\n      });\n    }\n  }\n\n  async qupdate() {\n    if (this.context[\"auth\"]) {\n      const token = \"Bearer \" + Cookies.get('JWT');\n      const qrequestOptions = {\n        method: 'GET',\n        headers: {\n          'Authorization': token\n        }\n      };\n      const qownresp = await fetch(`IOwner/${this.state.id}`, qrequestOptions);\n\n      if (qownresp.ok) {\n        const qown = await qownresp.json();\n        this.setState({\n          isOdmen: qown\n        });\n      }\n\n      const qresponse = await fetch(`event/${this.state.id}`, qrequestOptions);\n\n      if (qresponse.ok) {\n        const qdata = await qresponse.json();\n        this.setState({\n          qname: qdata[\"title\"],\n          qonline: !qdata[\"isSuspended\"]\n        });\n      }\n\n      const qlistresponse = await fetch(`get_queue/${this.state.id}`, qrequestOptions);\n\n      if (qlistresponse.ok) {\n        const qlist = await qlistresponse.json();\n        this.setState({\n          placeInQueue: -1\n        });\n\n        for (var i = 0; i < qlist.length; i++) {\n          if (qlist[i].idUser == this.state.userId) {\n            this.setState({\n              isInQueue: true,\n              placeInQueue: i + 1\n            });\n          }\n\n          ;\n        }\n\n        this.setState({\n          queue: qlist,\n          loading: false\n        });\n      }\n    } else {\n      this.setState({\n        redirect: true\n      });\n    }\n  }\n\n  click() {\n    this.setState({\n      clicker: this.state.clicker + 1\n    });\n  }\n\n  async handleJoin() {\n    if (!this.state.isOdmen) {\n      const token = \"Bearer \" + Cookies.get('JWT');\n      const requestOptions = {\n        method: 'POST',\n        headers: {\n          'Authorization': token\n        }\n      };\n\n      if (!this.state.isInQueue) {\n        const response = await fetch(`/queue/enter/${this.state.id}`, requestOptions);\n\n        if (response.ok) {\n          this.setState({\n            isInQueue: true\n          });\n          this.qupdate();\n        }\n      } else {\n        requestOptions[\"method\"] = 'DELETE';\n        const response = await fetch(`/queue/delete/${this.state.id}`, requestOptions);\n\n        if (response.ok) {\n          this.setState({\n            isInQueue: false\n          });\n          this.qupdate();\n        }\n      }\n    } else {\n      this.setState({\n        redirect: true\n      });\n    }\n  }\n\n  render() {\n    let queue = this.state.queue;\n    let qname = this.state.qname;\n    let qsize = this.state.queue.length;\n    let qid = this.state.id;\n    let clicker = this.state.clicker;\n    let isOdmen = this.state.isOdmen;\n    let qstate = this.state.qonline;\n    let place = this.state.placeInQueue;\n    let inQ = this.state.isInQueue;\n\n    const Button1 = () => {\n      if (isOdmen) {\n        return /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"next_button\",\n          onClick: this.handleNext,\n          children: \"NEXT\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 171,\n          columnNumber: 24\n        }, this);\n      } else {\n        if (inQ) {\n          return /*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              backgroundColor: \"#E87C64\"\n            },\n            className: \"join_button\",\n            onClick: this.handleJoin,\n            children: \"LEAVE\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 174,\n            columnNumber: 28\n          }, this);\n        } else {\n          return /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"join_button\",\n            onClick: this.handleJoin,\n            children: \"JOIN\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 176,\n            columnNumber: 28\n          }, this);\n        }\n      }\n    };\n\n    const Button2 = () => {\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"ppl_inqueue\",\n        children: qsize\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 182,\n        columnNumber: 20\n      }, this);\n    };\n\n    const Button3 = () => {\n      if (isOdmen) {\n        if (qstate) {\n          return /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"freeze_button\",\n            onClick: this.handleFreeze,\n            children: [\"Freeze\", /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 188,\n              columnNumber: 93\n            }, this), \"queue\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 188,\n            columnNumber: 28\n          }, this);\n        } else {\n          return /*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              backgroundColor: \"#CCCCCC\"\n            },\n            className: \"freeze_button\",\n            onClick: this.handleFreeze,\n            children: [\"Freeze\", /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 190,\n              columnNumber: 130\n            }, this), \"queue\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 190,\n            columnNumber: 28\n          }, this);\n        }\n      } else {\n        return /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"your_place\",\n          onClick: this.alert,\n          children: [\"You\", /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 193,\n            columnNumber: 76\n          }, this), place]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 193,\n          columnNumber: 24\n        }, this);\n      }\n    };\n\n    const Button4 = () => {\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"clicker\",\n        onClick: this.click,\n        children: [clicker, /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 198,\n          columnNumber: 75\n        }, this), \"Click!\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 198,\n        columnNumber: 20\n      }, this);\n    };\n\n    if (this.state.redirect) {\n      return /*#__PURE__*/_jsxDEV(Redirect, {\n        push: true,\n        to: `/`\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 202,\n        columnNumber: 21\n      }, this);\n    }\n\n    const listElement = index => {\n      if (index == 0) {\n        return {\n          backgroundColor: \"#82FF9D\"\n        };\n      } else if (index == place - 1) {\n        return {\n          backgroundColor: \"#EDB734\"\n        };\n      } else {\n        return {\n          backgroundColor: \"white\"\n        };\n      }\n    };\n\n    return /*#__PURE__*/_jsxDEV(Container, {\n      fluid: true,\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"main_block\",\n        children: [/*#__PURE__*/_jsxDEV(Row, {\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"queue_name\",\n            children: /*#__PURE__*/_jsxDEV(Row, {\n              style: {\n                width: \"100%\"\n              },\n              children: [/*#__PURE__*/_jsxDEV(Col, {\n                xs: \"9\",\n                className: \"queue_name_col\",\n                children: qname\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 223,\n                columnNumber: 33\n              }, this), /*#__PURE__*/_jsxDEV(Col, {\n                xs: \"3\",\n                className: \"col3_custom\",\n                children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"copy_link_button\",\n                  onClick: this.alert,\n                  \"data-toggle\": \"tooltip\",\n                  \"data-placement\": \"top\",\n                  title: \"Copy queue link\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 227,\n                  columnNumber: 37\n                }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                  style: {\n                    backgroundColor: qstate ? \"#82FF9D\" : \"#CCCCCC\"\n                  },\n                  className: \"queue_state\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 229,\n                  columnNumber: 37\n                }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"queue_edit_button\",\n                  onClick: this.alert,\n                  \"data-toggle\": \"tooltip\",\n                  \"data-placement\": \"top\",\n                  title: \"Edit queue\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 231,\n                  columnNumber: 37\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 226,\n                columnNumber: 33\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 222,\n              columnNumber: 29\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 221,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 220,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(Row, {\n          className: \"queue_block\",\n          children: [/*#__PURE__*/_jsxDEV(Col, {\n            sm: \"8\",\n            children: /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"queue\",\n              children: /*#__PURE__*/_jsxDEV(Virtuoso, {\n                components: {\n                  Scroller: CustomScrollbar\n                },\n                className: \"QList\",\n                data: queue,\n                itemContent: (index, Queue) => /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"QItem\",\n                  style: listElement(index),\n                  children: [Queue.username, \" \", Queue.idUser]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 245,\n                  columnNumber: 68\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 241,\n                columnNumber: 33\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 240,\n              columnNumber: 29\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 239,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(Col, {\n            sm: \"4\",\n            children: /*#__PURE__*/_jsxDEV(Row, {\n              className: \"buttons\",\n              children: [/*#__PURE__*/_jsxDEV(Col, {\n                sm: \"6\",\n                className: \"button\",\n                children: Button1()\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 252,\n                columnNumber: 33\n              }, this), /*#__PURE__*/_jsxDEV(Col, {\n                sm: \"6\",\n                className: \"button\",\n                children: Button2()\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 255,\n                columnNumber: 33\n              }, this), /*#__PURE__*/_jsxDEV(Col, {\n                sm: \"6\",\n                className: \"button\",\n                children: Button3()\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 258,\n                columnNumber: 33\n              }, this), /*#__PURE__*/_jsxDEV(Col, {\n                sm: \"6\",\n                className: \"button\",\n                children: Button4()\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 261,\n                columnNumber: 33\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 251,\n              columnNumber: 29\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 250,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 238,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 219,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 218,\n      columnNumber: 13\n    }, this);\n  }\n\n}\nGeneralQueue.displayName = GeneralQueue.name;\nGeneralQueue.contextType = AppContext;\nexport default _c = withRouter(GeneralQueue);\n\nvar _c;\n\n$RefreshReg$(_c, \"%default%\");","map":{"version":3,"sources":["D:/project/QQMerged/ClientApp/src/components/GeneralQueue.jsx"],"names":["React","Component","Container","Row","Col","Cookies","Virtuoso","CustomScrollbar","Redirect","withRouter","AppContext","GeneralQueue","constructor","props","intervalID","state","qname","queue","qonline","loading","id","match","params","isOdmen","redirect","clicker","isInQueue","placeInQueue","userId","sessionStorage","getItem","handleNext","bind","click","handleFreeze","handleJoin","componentDidMount","setInterval","qupdate","componentWillUnmount","clearInterval","console","log","token","get","requestOptions","method","headers","response","fetch","ok","setState","context","qrequestOptions","qownresp","qown","json","qresponse","qdata","qlistresponse","qlist","i","length","idUser","render","qsize","qid","qstate","place","inQ","Button1","backgroundColor","Button2","Button3","alert","Button4","listElement","index","width","Scroller","Queue","username","displayName","name","contextType"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\r\nimport { Container, Row, Col} from 'reactstrap';\r\nimport Cookies from 'js-cookie'\r\nimport { Virtuoso } from 'react-virtuoso';\r\nimport CustomScrollbar from \"./CustomScroller\";\r\nimport \"overlayscrollbars/css/OverlayScrollbars.css\";\r\nimport './GeneralQueue.scss';\r\nimport {Redirect, withRouter} from \"react-router-dom\";\r\nimport {AppContext} from './AppContext.jsx';\r\n\r\nexport class GeneralQueue extends Component {\r\n    static displayName = GeneralQueue.name;\r\n\r\n    constructor(props) {\r\n        super(props);\r\n        this.intervalID = 0;\r\n        this.state = { qname: \"\", queue: [], qonline: true, loading: true, id: this.props.match.params.id, isOdmen: false, redirect: false, clicker: 0, \r\n            isInQueue: false, placeInQueue: -1, userId: sessionStorage.getItem('id')};\r\n\r\n        this.handleNext = this.handleNext.bind(this);\r\n        this.click = this.click.bind(this);\r\n        this.handleFreeze = this.handleFreeze.bind(this);\r\n        this.handleJoin = this.handleJoin.bind(this);\r\n    }\r\n\r\n    componentDidMount() {\r\n        this.intervalID = setInterval(() => { this.qupdate(); }, 3000);\r\n    }\r\n\r\n    componentWillUnmount() {\r\n        clearInterval(this.intervalID);\r\n    }\r\n\r\n    async handleNext() {\r\n        console.log(\"next\");\r\n        if (this.state.isOdmen) {\r\n\r\n            const token = \"Bearer \" + Cookies.get('JWT');\r\n            const requestOptions = {\r\n                method: 'PUT',\r\n                headers: { 'Authorization': token }\r\n            };\r\n\r\n            const response = await fetch(`/queue/${this.state.id}/moder/next`, requestOptions);\r\n\r\n            if (response.ok) {\r\n                this.qupdate();\r\n            }\r\n        }\r\n        else {\r\n            this.setState({ redirect: true });\r\n        }\r\n    }\r\n\r\n\r\n    async handleFreeze() {\r\n        if (this.state.isOdmen) {\r\n            const token = \"Bearer \" + Cookies.get('JWT');\r\n            const requestOptions = {\r\n                method: 'PUT',\r\n                headers: { 'Authorization': token }\r\n            };\r\n\r\n\r\n            if (this.state.qonline) {\r\n                const response = await fetch(`/queue/${this.state.id}/moder/close`, requestOptions);\r\n                if (response.ok) {\r\n                    this.qupdate();\r\n                }\r\n            } else {\r\n                const response = await fetch(`/queue/${this.state.id}/moder/open`, requestOptions);\r\n                if (response.ok) {\r\n                    this.qupdate();\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            this.setState({ redirect: true });\r\n        }\r\n    }\r\n\r\n\r\n    async qupdate() {\r\n        if (this.context[\"auth\"]) {\r\n            const token = \"Bearer \" + Cookies.get('JWT');\r\n\r\n            const qrequestOptions = {\r\n                method: 'GET',\r\n                headers: { 'Authorization': token }\r\n            };\r\n\r\n            const qownresp = await fetch(`IOwner/${this.state.id}`, qrequestOptions);\r\n            if (qownresp.ok) {\r\n                const qown = await qownresp.json();\r\n                this.setState({ isOdmen: qown });\r\n            }\r\n\r\n            const qresponse = await fetch(`event/${this.state.id}`, qrequestOptions);\r\n            if (qresponse.ok) {\r\n                const qdata = await qresponse.json();\r\n                this.setState({ qname: qdata[\"title\"], qonline: !qdata[\"isSuspended\"] });\r\n            }\r\n\r\n            const qlistresponse = await fetch(`get_queue/${this.state.id}`, qrequestOptions);\r\n            if (qlistresponse.ok) {\r\n                const qlist = await qlistresponse.json();\r\n\r\n                this.setState({ placeInQueue: -1 });\r\n\r\n                for (var i = 0; i < qlist.length; i++) {\r\n                    if (qlist[i].idUser == this.state.userId) {\r\n                        this.setState({ isInQueue: true, placeInQueue: i + 1 });\r\n                    };\r\n                }\r\n\r\n                this.setState({ queue: qlist, loading: false });\r\n            }\r\n        }\r\n        else {\r\n            this.setState({ redirect: true });\r\n        }\r\n    }\r\n\r\n    click() {\r\n        this.setState({ clicker: this.state.clicker + 1 });\r\n    }\r\n\r\n\r\n    async handleJoin() {\r\n        if (!this.state.isOdmen) {\r\n            const token = \"Bearer \" + Cookies.get('JWT');\r\n            const requestOptions = {\r\n                method: 'POST',\r\n                headers: { 'Authorization': token }\r\n            };\r\n\r\n            if (!this.state.isInQueue) {\r\n                const response = await fetch(`/queue/enter/${this.state.id}`, requestOptions);\r\n                if (response.ok) {\r\n                    this.setState({ isInQueue: true });\r\n                    this.qupdate();\r\n                }\r\n            } else {\r\n                requestOptions[\"method\"] = 'DELETE';\r\n                const response = await fetch(`/queue/delete/${this.state.id}`, requestOptions);\r\n                if (response.ok) {\r\n                    this.setState({ isInQueue: false });\r\n                    this.qupdate();\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            this.setState({ redirect: true });\r\n        }\r\n    }\r\n\r\n\r\n    render() {\r\n        let queue = this.state.queue\r\n        let qname = this.state.qname\r\n        let qsize = this.state.queue.length\r\n        let qid = this.state.id\r\n        let clicker = this.state.clicker\r\n        let isOdmen = this.state.isOdmen;\r\n        let qstate = this.state.qonline;\r\n        let place = this.state.placeInQueue;\r\n        let inQ = this.state.isInQueue;\r\n\r\n        const Button1 = () => {\r\n            if (isOdmen) {\r\n                return <div className=\"next_button\" onClick={this.handleNext}>NEXT</div>;\r\n            } else {\r\n                if (inQ) {\r\n                    return <div style={{backgroundColor: \"#E87C64\"}} className=\"join_button\" onClick={this.handleJoin}>LEAVE</div>;\r\n                } else {\r\n                    return <div className=\"join_button\" onClick={this.handleJoin}>JOIN</div>;\r\n                }\r\n            }\r\n        }\r\n\r\n        const Button2 = () => {\r\n            return <div className=\"ppl_inqueue\">{qsize}</div>;\r\n        }\r\n\r\n        const Button3 = () => {\r\n            if (isOdmen) {\r\n                if (qstate) {\r\n                    return <div className=\"freeze_button\" onClick={this.handleFreeze}>Freeze<br />queue</div>;\r\n                } else {\r\n                    return <div style={{backgroundColor: \"#CCCCCC\"}} className=\"freeze_button\" onClick={this.handleFreeze}>Freeze<br />queue</div>;\r\n                }\r\n            } else {\r\n                return <div className=\"your_place\" onClick={this.alert}>You<br/>{place}</div>;\r\n            }\r\n        }\r\n\r\n        const Button4 = () => {\r\n            return <div className=\"clicker\" onClick={this.click}>{clicker}<br />Click!</div>;\r\n        }\r\n\r\n        if (this.state.redirect) {\r\n            return (<Redirect push to={`/`} />);\r\n        }\r\n\r\n        const listElement = (index) => {\r\n            if (index == 0) {\r\n                return {backgroundColor: \"#82FF9D\"};\r\n            }\r\n            else if (index == place-1) {\r\n                return {backgroundColor: \"#EDB734\"};\r\n            }\r\n            else {\r\n                return {backgroundColor: \"white\"};\r\n            }\r\n        }\r\n\r\n        return (\r\n            <Container fluid>\r\n                <div className=\"main_block\">\r\n                    <Row>\r\n                        <div className=\"queue_name\">\r\n                            <Row style={{width:\"100%\"}}>\r\n                                <Col xs=\"9\" className=\"queue_name_col\">\r\n                                    {qname}\r\n                                </Col>\r\n                                <Col xs=\"3\" className=\"col3_custom\">\r\n                                    <div className=\"copy_link_button\" onClick={this.alert} data-toggle=\"tooltip\" data-placement=\"top\" title=\"Copy queue link\">\r\n                                    </div>\r\n                                    <div style={{ backgroundColor: qstate ? \"#82FF9D\" : \"#CCCCCC\" }} className=\"queue_state\">\r\n                                    </div>\r\n                                    <div className=\"queue_edit_button\" onClick={this.alert} data-toggle=\"tooltip\" data-placement=\"top\" title=\"Edit queue\">\r\n                                    </div>\r\n                                </Col>\r\n                            </Row>\r\n                        </div>\r\n                    </Row>\r\n\r\n                    <Row className=\"queue_block\">\r\n                        <Col sm=\"8\">\r\n                            <div className=\"queue\">\r\n                                <Virtuoso\r\n                                    components={{Scroller: CustomScrollbar}}\r\n                                    className=\"QList\"\r\n                                    data={queue}\r\n                                    itemContent={(index, Queue) => <div className=\"QItem\" style={listElement(index)}>{Queue.username} {Queue.idUser}</div>}\r\n                                />\r\n                            </div>\r\n                        </Col>\r\n\r\n                        <Col sm=\"4\">\r\n                            <Row className=\"buttons\">\r\n                                <Col sm=\"6\" className=\"button\">\r\n                                    {Button1()}\r\n                                </Col>\r\n                                <Col sm=\"6\" className=\"button\">\r\n                                    {Button2()}\r\n                                </Col>\r\n                                <Col sm=\"6\" className=\"button\">\r\n                                    {Button3()}\r\n                                </Col>\r\n                                <Col sm=\"6\" className=\"button\">\r\n                                    {Button4()}\r\n                                </Col>\r\n                            </Row>\r\n                        </Col>\r\n                    </Row>\r\n                </div>\r\n            </Container>\r\n        );\r\n    }\r\n}\r\n\r\nGeneralQueue.contextType = AppContext;\r\nexport default withRouter(GeneralQueue);"]},"metadata":{},"sourceType":"module"}